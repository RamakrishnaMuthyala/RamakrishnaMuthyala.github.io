<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resume | Ramakrishna Portfolio</title>

  <!-- Boxicons and Custom CSS -->
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="index.css" />
  <!-- Google Analytics (ADD THIS) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-F27XB2JWE8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-F27XB2JWE8');
  </script>
</head>
<body>
  <!-- Header -->
  <header class="container">
    <div class="page-header">
      <div class="logo">
        <a href="index.html"><span class="logo-text">R</span>M</a>
      </div>
      <input type="checkbox" id="click">
      <label for="click" class="mainicon">
        <div class="menu">
          <i class='bx bx-menu'></i>
        </div>
      </label>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="skills.html">Skills</a></li>
        <li><a href="professional-journey.html">Professional Journey</a></li>
        <li><a href="resume.html" class="active">Resume</a></li>
      </ul>
      <label class="mode" title="Dark Mode">
        <input type="checkbox" id="darkModeToggle">
        <i class='bx bxs-sun'></i>
      </label>
    </div>
  </header>

  <!-- Resume Section -->
  <section class="resume-section-modern container">
    <div class="resume-card">
      <h2 class="resume-title">My Resume</h2>
      <p class="resume-subtext">Preview or download my resume below.</p>

      <div class="resume-buttons">
        <!-- ✅ Added ID -->
        <button id="view-resume" class="btn-modern view" onclick="openResumeModal()">
          <i class='bx bx-show'></i> View Resume
        </button>

        <!-- ✅ Added ID -->
        <a id="download-resume" href="Resume.pdf" download class="btn-modern download">
          <i class='bx bx-download'></i> Download Resume
        </a>
      </div>
    </div>

    <!-- ✅ Single Clean Modal -->
    <div id="resumeModal" class="resume-modal">
      <div class="resume-modal-content">
        <span class="resume-close" onclick="closeResumeModal()">&times;</span>
        <iframe src="Resume.pdf" class="resume-iframe" title="Resume PDF"></iframe>
      </div>
    </div>
  </section>

  <!-- ✅ GA Tracking Script -->
  <script>
    document.getElementById('view-resume')?.addEventListener('click', function () {
      gtag('event', 'resume_view', {
        event_category: 'engagement',
        event_label: 'View Resume'
      });
    });

    document.getElementById('download-resume')?.addEventListener('click', function () {
      gtag('event', 'resume_download', {
        event_category: 'engagement',
        event_label: 'Download Resume'
      });
    });
  </script>

  <!-- ✅ Modal JS -->
  <script>
    function openResumeModal() {
      const modal = document.getElementById("resumeModal");
      modal.style.display = "flex";
    }

    function closeResumeModal() {
      const modal = document.getElementById("resumeModal");
      modal.style.display = "none";
    }

    window.onclick = function (event) {
      const modal = document.getElementById("resumeModal");
      if (event.target === modal) {
        modal.style.display = "none";
      }
    };
  </script>

  <script>
    (async () => {
      try {
        if (sessionStorage.getItem("visitor-logged")) return;
    
        const ipRes = await fetch("https://ipapi.co/json");
        const ipData = await ipRes.json();
    
        await fetch("https://script.google.com/macros/s/AKfycbzVQx4xRwydBRimunuHv3e-JiJUHZJzmd9oMT8OkMuw16TAh9ODGxdVZBTIZLW5mjc8ow/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            ip: ipData.ip,
            city: ipData.city,
            country: ipData.country_name,
            browser: navigator.userAgent,
            referrer: document.referrer,
            page: window.location.pathname
          })
        });
    
        sessionStorage.setItem("visitor-logged", "1");
      } catch (err) {
        console.error("Visitor log failed", err);
      }
    })();
    </script>
    <script> 
  function doPost(e) {
    const sheet = SpreadsheetApp.openById("1I2qxL54a-0sznyr0bbBPY-b5ligFQ2F-4AacCRw9ON4").getSheetByName("Visitors");
    const data = JSON.parse(e.postData.contents);
  
    sheet.appendRow([
      new Date(),
      data.ip,
      data.city,
      data.country,
      data.browser,
      data.referrer,
      data.page
    ]);
  
    return ContentService.createTextOutput(JSON.stringify({ status: "success" }))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
</script>
  <script>
  <!-- ✅ Visitor Tracking Script (Moved to end, logs to Google Sheet) -->
  function doPost(e) {
    const headers = {
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "POST",
      "Access-Control-Allow-Headers": "Content-Type",
      "Content-Type": "application/json"
    };
  
    try {
      const data = JSON.parse(e.postData.contents);
      const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Visitors");
  
      sheet.appendRow([
        new Date(),
        data.ip || '',
        data.city || '',
        data.country || '',
        data.browser || '',
        data.referrer || '',
        data.page || ''
      ]);
  
      return ContentService.createTextOutput("Success")
        .setMimeType(ContentService.MimeType.JSON)
        .setHeaders(headers);
    } catch (err) {
      return ContentService.createTextOutput("Error: " + err.message)
        .setMimeType(ContentService.MimeType.JSON)
        .setHeaders(headers);
    }
  }
</script>
<script>
function doOptions(e) {
  return ContentService.createTextOutput("")
    .setMimeType(ContentService.MimeType.JSON)
    .setHeaders({
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "POST, OPTIONS",
      "Access-Control-Allow-Headers": "Content-Type"
    });
}
</script>
</body> 
</html>
